# =============================================================================
# POCKET POS - PostgreSQL Host-Based Authentication Configuration
# =============================================================================
# This file controls client authentication for PostgreSQL connections
# TYPE  DATABASE        USER            ADDRESS                 METHOD

# =============================================================================
# LOCAL CONNECTIONS
# =============================================================================

# "local" is for Unix domain socket connections only
local   all             all                                     trust

# =============================================================================
# IPv4 LOCAL CONNECTIONS
# =============================================================================

# Allow connections from localhost
host    all             all             127.0.0.1/32            scram-sha-256

# Allow connections from Docker network (development)
host    all             all             172.16.0.0/12           scram-sha-256
host    all             all             192.168.0.0/16          scram-sha-256
host    all             all             10.0.0.0/8              scram-sha-256

# =============================================================================
# IPv6 LOCAL CONNECTIONS
# =============================================================================

# IPv6 local connections
host    all             all             ::1/128                 scram-sha-256

# =============================================================================
# DEVELOPMENT SPECIFIC CONNECTIONS
# =============================================================================

# Allow development database connections from Docker containers
host    pocketpos_dev   pocketpos_dev   172.16.0.0/12           scram-sha-256
host    pocketpos_dev   pocketpos_dev   192.168.0.0/16          scram-sha-256
host    pocketpos_dev   pocketpos_dev   10.0.0.0/8              scram-sha-256

# Allow test database connections
host    pocketpos_test  pocketpos_dev   172.16.0.0/12           scram-sha-256
host    pocketpos_test  pocketpos_dev   192.168.0.0/16          scram-sha-256
host    pocketpos_test  pocketpos_dev   10.0.0.0/8              scram-sha-256

# =============================================================================
# PRODUCTION SPECIFIC CONNECTIONS
# =============================================================================

# Production database connections (restrict to specific networks)
host    pocketpos_prod  pocketpos_prod  172.16.0.0/12           scram-sha-256
host    pocketpos_prod  pocketpos_prod  192.168.0.0/16          scram-sha-256
host    pocketpos_prod  pocketpos_prod  10.0.0.0/8              scram-sha-256

# =============================================================================
# READ-ONLY USER CONNECTIONS
# =============================================================================

# Allow read-only user from Docker networks
host    pocketpos_dev   pocketpos_readonly  172.16.0.0/12       scram-sha-256
host    pocketpos_dev   pocketpos_readonly  192.168.0.0/16      scram-sha-256
host    pocketpos_dev   pocketpos_readonly  10.0.0.0/8          scram-sha-256

host    pocketpos_prod  pocketpos_readonly  172.16.0.0/12       scram-sha-256
host    pocketpos_prod  pocketpos_readonly  192.168.0.0/16      scram-sha-256
host    pocketpos_prod  pocketpos_readonly  10.0.0.0/8          scram-sha-256

# =============================================================================
# REPLICATION CONNECTIONS
# =============================================================================

# Allow replication connections from Docker networks
host    replication     pocketpos_prod  172.16.0.0/12           scram-sha-256
host    replication     pocketpos_prod  192.168.0.0/16          scram-sha-256
host    replication     pocketpos_prod  10.0.0.0/8              scram-sha-256

# =============================================================================
# SECURITY NOTES
# =============================================================================
#
# 1. AUTHENTICATION METHODS:
#    - trust: Allow connection unconditionally (DEVELOPMENT ONLY)
#    - scram-sha-256: Password authentication using SCRAM-SHA-256
#    - md5: Password authentication using MD5 (less secure, avoid if possible)
#    - cert: SSL certificate authentication
#    - ldap: LDAP authentication
#
# 2. NETWORK RANGES:
#    - 172.16.0.0/12: Docker default bridge networks
#    - 192.168.0.0/16: Private network range
#    - 10.0.0.0/8: Private network range
#
# 3. PRODUCTION CONSIDERATIONS:
#    - Use SSL certificates for production (cert method)
#    - Restrict network ranges to specific subnets
#    - Consider using LDAP or other enterprise authentication
#    - Enable SSL connections and require them for sensitive data
#
# 4. DEVELOPMENT CONSIDERATIONS:
#    - Current configuration allows connections from Docker networks
#    - Uses password authentication for security
#    - Separate users for different environments
#
# =============================================================================

# =============================================================================
# REJECT ALL OTHER CONNECTIONS
# =============================================================================
# Any connection not matching the above rules will be rejected
# This is implicit, but can be made explicit with:
# host    all             all             0.0.0.0/0               reject